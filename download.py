import gzip
import os
import re
from six.moves import urllib


def maybe_download(source, work_directory):
    m = re.search(r'([^/]+)\?+?', source)
    print source
    filepath = '%s/%s'%(work_directory, m.group(1))
    filepath, _ = urllib.request.urlretrieve(source, filepath)
    return filepath

def main():
    file = '/home/dien/workspace/virus-detection/data/dll-downlink.txt'
    dir = '/home/dien/workspace/virus-detection/data/dll-files'
    count = 1
    with open(file, 'r') as f:
        for line in f:
            print ('Downloading file %dth' % count),
            maybe_download(u'%s'%line.strip(), dir)
            count += 1
    print ('Total number of files: %d' % count)

if __name__ == '__main__':
    main()