import scrapy

class DllfilesDownlinkSpider(scrapy.Spider):
    name = "dll-files-downlink"

    def start_requests(self):
        filepath='/home/dien/workspace/virus-detection/data/dll-link.txt'
        with open(filepath, 'r') as f:
            for post_url in f:
                yield self.make_requests_from_url(u'http://www.dll-files.com%s'%post_url.strip())


    def parse(self, response):
        # filename = response.url.split("/")[-2] + '.html'
        # with open(filename, 'wb') as f:
        #     f.write(response.body)
        outfile = '/home/dien/workspace/virus-detection/data/dll-downlink.txt'
        f = open(outfile, 'a')
        if response.xpath('//div[@class="file_download"]'):
            link = response.xpath('//div[@class="file_download"]')[0].xpath('a/@href').extract()[0]
            f.write('%s\n'%link)
        f.close()